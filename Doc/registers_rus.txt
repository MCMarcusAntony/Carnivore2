Спецификация Carnivore2 MultiFunctional картриджа.
Copyright (c) 2017 RBSC


Регистры конфигурации
---------------------

Регистры конфигурации и управления начинаются с адреса 0F80h или 4F80h или 8F80h или СF80h или.. 
или нигде не начинаются а тихо прячутся. Всё зависит от того что записано в "нулевом" управляющем регистре
после включения питания инициализируются на адрес 4F80h. Все регистры доступны только для записи за ислкючением
псевдорегистра для доступа к FlashROM с целью её прошивки.

+00 CardMDR регистр управления конфигурацией картриджа
    7 bit = 1- запрет отображения регистров, 0- регистры отображаются
    6,5 bit = 0/1/2/3 - регистры отображаются начиная с адреса 0F80h/4F80h/8F80h/СF80h
    4 bit = 1- разрешение "чипа" SCC, 0- запрет
    3 bit = 1- режим отложенной конфигурации, 0- конфигурация меняется сразу после изменения управляющих регистров
    2 bit = 0- при отложенной конфигурации изменения вступают в силу после выполнения процессором команды с адреса 0000h
	  = 1- изменения вступают в силу после выполнения чтения с адреса 4000h
               отложенная конфигурация регистров действует только для AddrFR и регистров управления банками
    1,0 bit - резерв
    начальная конфигурация 20h

+01 AddrM0 - младший регистр адреса (7..0) для обращения к FlashROM c целью прошивки
+02 AddrM1 - средний регистр адреса (15..8) для обращения к FlashROM c целью прошивки
+03 AddrM2 - старший регистр адреса (22..16) для обращения к FlashROM c целью прошивки
+04 DatM0  - псевдорегистр для п#ередачи данных во FlashRОM или чтения с целью прошивки

+05 AddrFR - регистр номера блока FlashROM с которого будут читатся данные для эмуляции ROM (размер блока 64кб)
             начальная конфигурация 00h

Регистры конфигурации первого банка
-----------------------------------

+06 R1Mask - маска для адреса регистра страницы банка (этот регистр как правило дублируется на несколько адресов
             например для картриджа Konami 5 (SCC) эти адреса для первого банка  5000h-57FFh, сдесь задаётся 
             маска только старшего байта  - 11111000b или F8h
             начальная конфигурация F8h
+07 R1Addr - адрес регистра страницы банка, старший байт для адреса 5000h это 50h
             начальная конфигурация 50h
+08 R1Reg  - содержимое регистра страницы банка, сдесь задаётся начальное значение странцы перед запуском 
             содержимого ROM как правило = 00h
             начальная конфигурация 00h
+09 R1Mult - регистр режима банка и его размера
    7 bit = 1 - разрешение регистра страницы банка, 0 - управление страницой банка выключено
    6 bit = 1 - зеркалирование
    5 bit = 0 - выбор в качестве источника FlashROM, 1 - RAM
    4 bit = 1 - разрешение записи в банк, 0 - запрет записи в банк
    3 bit = 0 - банк включен, 1 банк выключен 
    2,1,0 bits - размер банка 111b = 64 Кбайт, 110b = 32 Кбайт, 101b = 16 Кбайт, 100b = 8 Кбайт, 011 = 4 Кбайт
            остальные значения - банк выключен
            начальная конфигурация 85h        
+0A B1MaskR- Маска для адресации банка в блок FlashROM (размер эмулируемой ROM или количество страничек, например
             для 128 кб ROM нужно 16 страничек по 8 Кб, значит выбираем маску = 0Fh или 00001111b)
	     начальная когфигурация 03h
+0B B1AdrD - Адрес банка, только старший байт.. для 4000h = 40h
             начальная конфигуарция 40h

Регистры конфигурации второго банка
-----------------------------------

+0C R2Mask
+0D R2Addr
+0E R2Reg
+0F R2Mult   начальное значение  00h, банк выключен
+10 B2MaskR
+11 B2AdrD
             
Регистры конфигурации третьего банка
------------------------------------

+12 R3Mask
+13 R3Addr
+14 R3Reg
+15 R3Mult   начальное значение  00h, банк выключен
+16 B3MaskR
+17 B3AdrD

Регистры конфигурации четвёртого банка
--------------------------------------

+18 R4Mask
+19 R4Addr
+1A R4Reg
+1B R4Mult   начальное значение  00h, банк выключен
+1C B4MaskR
+1D B4AdrD

+1E Mconf мультикартридж конфигурация, расширенный слот
    7 bit = 1 - разрешение расширенного слота  0 - один слот
    6 bit = 1 - разрешение чтения портов МММ-маппера FC,FD,FE,FF
    5 bit = 1 - разрешение YM2413 (FM Pack Synt. 3Ch,3Dh)
    4 bit = 1 - разрешение 3С порта (МММ-маппера)
    3 bit = 1 - разрешение -3 слота FM Pack bios ROM
    2 bit = 1 - разрешение -2 слота 1 Mb RAM с маппером (MMM стандарт)
    1 bit = 1 - разрешение -1 слота CF card интерфейс
    0 bit = 1 - разрешение -0 слота MSCC (и данного регистра)

+1F дубль регистра управления CardMDR (для использования команды LDIR)

+20 ConfFl -  регистр конфигурации чипа FlashROM
           2b - -BYTE = 0 для 8 разрядной шины данных, = 1 для 16 разрядной шины данных
           1b - -RP   - Reset/protect
           0b - +12VPP = 1 подать 12 вольт для режима скоростной записи, =0 запретить +12в 
	      начальная конфигурация 010b


Формат записи директории
------------------------

[00] ACT - Флаг активности записи (FF - пустая запись)
[01] PSV - Пассивная запись (FF - не пассивная)
[02] STB - Стартовый блок 
[03] LNB - Длина в блоках

        Будущий вариант			|    Текущий вариант
     
 [04,05,06,07,08,09,0A,0B] Имя файлы   	| [04] - Тип маппера записи
 [0C,0D,0E] Расширение			| [05 - 22] Текст (имя записи)
 [0F] REZ - Резерв			|
 [10 - 22] Текст (19 байт)		|

[23 24 25 26 27 28] R1Mask R1Addr R1Reg R1Mult B1MaskR B1AdrD - 6 byte 1st Bank ROM Mapper
[29 2A 2B 2C 2D 2E] R2Mask R2Addr R2Reg R2Mult B2MaskR B2AdrD - 6 byte 2nd Bank ROM Mapper
[2F 30 31 32 33 34] R3Mask R3Addr R3Reg R3Mult B3MaskR B3AdrD - 6 byte 3st Bank ROM Mapper
[35 36 37 38 39 3A] R4Mask R4Addr R4Reg R4Mult B4MaskR B4AdrD - 6 byte 4st Bank ROM Mapper

[3B] - Mconf мультикартридж конфигурация, расширенный слот 
[3C] - CardMDR

[3D] - bit 7,6,5,4 позиция в 64кб блоке,3-резерв, 2,1,0 bits - размер miniROM 110b = 32 Кбайт,
	 101b = 16 Кбайт, 100b = 8 Кбайт, 011 = 4 Кбайт 000= не miniROM
[3E] - RESET опция  Bit0 =0 - no reset =1 - reset
		    Bit1 =0 - RET func =1 - jmp ROMini addr
		    Bit2 =0 - jmp (4002) =1 - jmp (8002)
[3F] - Резерв


Адреса записи специальных значений в мелкое ППЗУ
------------------------------------------------

[00] - громкость FMPAC и SCC. По 3 бита на громкость, максимальное значение - 8. Первые 2 бита используются как признак того,
       что громкость была предварительно записана в ППЗУ
[01] - флаг 50 или 60 Гц развёртки для видеопроцессора. Бит 1 в этом байте - сам флаг. Если бит в нуле, то используется 60 Гц
